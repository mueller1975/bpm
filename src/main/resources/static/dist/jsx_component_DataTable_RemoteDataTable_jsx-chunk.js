"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkbpm"] = self["webpackChunkbpm"] || []).push([["jsx_component_DataTable_RemoteDataTable_jsx"],{

/***/ "./jsx/component/DataTable/RemoteDataTable.jsx":
/*!*****************************************************!*\
  !*** ./jsx/component/DataTable/RemoteDataTable.jsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var Tools__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! Tools */ \"./jsx/lib/tools.js\");\nObject(function webpackMissingModule() { var e = new Error(\"Cannot find module 'Config'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }());\n/* harmony import */ var Hook_useTools_jsx__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! Hook/useTools.jsx */ \"./jsx/hook/useTools.jsx\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _DataTableX_jsx__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./DataTableX.jsx */ \"./jsx/component/DataTable/DataTableX.jsx\");\n\n\n\n\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_3___default().memo( /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_3___default().forwardRef((props, ref) => {\n  const {\n    options,\n    filter,\n    filterParams,\n    actionButtons,\n    storageKey,\n    rowKey,\n    enableKeywordSearch = false,\n    showCheckbox = false,\n    resizable = false,\n    alignDetailToRight = true,\n    innerTable = false,\n    roundCorner = false,\n    onClickRow,\n    onDoubleClickRow,\n    onSelectRow,\n    loading = false\n  } = props;\n  const {\n    columns,\n    title,\n    serviceUrl,\n    exportUrl,\n    params,\n    urlParams,\n    page = 0,\n    pageSize,\n    sizeOptions,\n    sortProp,\n    sortOrder\n  } = options;\n  const [queryParams, setQueryParams] = (0,react__WEBPACK_IMPORTED_MODULE_3__.useState)();\n  const tableRef = (0,react__WEBPACK_IMPORTED_MODULE_3__.useRef)();\n  const {\n    showError\n  } = (0,Hook_useTools_jsx__WEBPACK_IMPORTED_MODULE_2__.useNotification)(); // 訊息提示 function\n\n  const urlParamString = (0,react__WEBPACK_IMPORTED_MODULE_3__.useMemo)(() => {\n    if (urlParams) {\n      return Object.entries(urlParams).map(([name, value]) => `${name}=${value}`).join('&');\n    }\n  }, [urlParams]);\n\n  /* expose functions to parent component */\n  (0,react__WEBPACK_IMPORTED_MODULE_3__.useImperativeHandle)(ref, () => ({\n    // 取得表格目前查詢參數\n    getRequestParams: () => {\n      const {\n        sorting,\n        searchKeyword,\n        filterOn,\n        columns: tableColumns\n      } = queryParams;\n      let filter = (0,Tools__WEBPACK_IMPORTED_MODULE_0__.getFilter)(searchKeyword, filterOn ? filterParams : null, params);\n      let sortProps = (0,Tools__WEBPACK_IMPORTED_MODULE_0__.buildSortParams)(sorting);\n      let exportColumns = tableColumns.filter(header => !header.hidden); // 不匯出隱藏欄位\n\n      let reqParams = {\n        size: 0,\n        filter,\n        sortProps,\n        exportColumns\n      }; // size 設為 0, 匯出所有查詢結果 \n\n      return reqParams;\n    },\n    // 重新查詢\n    reload: () => setQueryParams({\n      ...queryParams\n    }),\n    getSelectedRows: () => tableRef.current.getSelectedRows(),\n    // 取得選取的資料列\n    getSelectedRowIndices: () => tableRef.current.getSelectedRowIndices() // 取得選取的資料列 index\n  }), [queryParams, filterParams, params]);\n\n  // 查詢後端資料 async function\n  const fetchDataFunc = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(() => {\n    if (queryParams?.pagination) {\n      const {\n        pagination,\n        sorting,\n        searchKeyword,\n        filterOn\n      } = queryParams;\n      const {\n        page,\n        size\n      } = pagination;\n      let filter = (0,Tools__WEBPACK_IMPORTED_MODULE_0__.getFilter)(searchKeyword, filterOn ? filterParams : null, params);\n      let sortProps = (0,Tools__WEBPACK_IMPORTED_MODULE_0__.buildSortParams)(sorting);\n      let reqParams = {\n        page,\n        size,\n        filter,\n        sortProps\n      };\n      return !serviceUrl ? null : fetch(serviceUrl + (!urlParamString ? '' : (serviceUrl.indexOf('?') > -1 ? '&' : '?') + urlParamString), {\n        body: JSON.stringify(reqParams),\n        method: 'POST',\n        redirect: 'manual',\n        headers: {\n          'Content-Type': 'application/json',\n          [Object(function webpackMissingModule() { var e = new Error(\"Cannot find module 'Config'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }())]: Object(function webpackMissingModule() { var e = new Error(\"Cannot find module 'Config'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }())\n        }\n      });\n    }\n  }, [params, queryParams]);\n\n  // hook 查詢後端資料 async function\n  const {\n    execute: fetchData,\n    pending: fetching,\n    value: fetchedData,\n    error: fetchError\n  } = (0,Hook_useTools_jsx__WEBPACK_IMPORTED_MODULE_2__.useResponseVO)(fetchDataFunc);\n\n  // 執行查詢後端資料\n  (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n    fetchData();\n  }, [fetchData]);\n\n  // 處理查詢失敗\n  (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n    fetchError && showError(fetchError.message); // 提示查詢失敗訊息\n  }, [fetchError]);\n\n  /* 查詢關鍵字/過濾條件/排序 變動時, 更新匯出資料 function */\n  const exportFileFunc = !exportUrl ? undefined : (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(() => {\n    if (queryParams?.pagination) {\n      const {\n        sorting,\n        searchKeyword,\n        filterOn,\n        columns: tableColumns\n      } = queryParams;\n      let filter = (0,Tools__WEBPACK_IMPORTED_MODULE_0__.getFilter)(searchKeyword, filterOn ? filterParams : null, params);\n      let sortProps = (0,Tools__WEBPACK_IMPORTED_MODULE_0__.buildSortParams)(sorting);\n      let exportColumns = tableColumns.filter(header => !header.hidden); // 不匯出隱藏欄位\n\n      let reqParams = {\n        size: 0,\n        filter,\n        sortProps,\n        exportColumns\n      }; // size 設為 0, 匯出所有查詢結果 \n\n      return !exportUrl ? null : fetch(exportUrl + (!urlParamString ? '' : (serviceUrl.indexOf('?') > -1 ? '&' : '?') + urlParamString), {\n        body: JSON.stringify(reqParams),\n        method: 'POST',\n        redirect: 'manual',\n        headers: {\n          'Content-Type': 'application/json',\n          [Object(function webpackMissingModule() { var e = new Error(\"Cannot find module 'Config'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }())]: Object(function webpackMissingModule() { var e = new Error(\"Cannot find module 'Config'\"); e.code = 'MODULE_NOT_FOUND'; throw e; }())\n        }\n      });\n    }\n  }, [params, queryParams]);\n\n  // hook 匯出資料 asyc function\n  const {\n    execute: exportFile,\n    pending: exporting,\n    error: exportError\n  } = !exportUrl ? {} : (0,Hook_useTools_jsx__WEBPACK_IMPORTED_MODULE_2__.useAsyncDownload)(exportFileFunc);\n  (0,react__WEBPACK_IMPORTED_MODULE_3__.useEffect)(() => {\n    exportError && showError(exportError.message);\n  }, [exportError]);\n\n  // 在 DataTable 操作會觸發更新資料的 UI 動作\n  const tableQueryHandler = (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(tableParams => setQueryParams(tableParams), []);\n\n  // 匯出檔案\n  const exportHandler = !exportUrl ? undefined : (0,react__WEBPACK_IMPORTED_MODULE_3__.useCallback)(() => {\n    exportFile();\n  }, [exportFile]);\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_3___default().createElement(_DataTableX_jsx__WEBPACK_IMPORTED_MODULE_4__[\"default\"], {\n    ref: tableRef,\n    title: title,\n    columns: columns,\n    data: fetchedData,\n    dataError: fetchError,\n    sortProp: sortProp,\n    sortOrder: sortOrder,\n    page: page,\n    pageSize: pageSize,\n    sizeOptions: sizeOptions,\n    filter: filter,\n    filterParams: filterParams,\n    processing: fetching || exporting || loading,\n    actionButtons: actionButtons,\n    storageKey: storageKey,\n    enableKeywordSearch: enableKeywordSearch,\n    showCheckbox: showCheckbox,\n    resizable: resizable,\n    alignDetailToRight: alignDetailToRight,\n    innerTable: innerTable,\n    roundCorner: roundCorner,\n    onClickRow: onClickRow,\n    onDoubleClickRow: onDoubleClickRow,\n    onSelectRow: onSelectRow,\n    onQuery: tableQueryHandler,\n    onExport: exportHandler\n  });\n})));\n\n//# sourceURL=webpack://bpm/./jsx/component/DataTable/RemoteDataTable.jsx?");

/***/ })

}]);